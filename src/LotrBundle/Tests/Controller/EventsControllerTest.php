<?php

namespace LotrBundle\Tests\Controller;

use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class EventsControllerTest extends WebTestCase
{
	public function testGetEvents()
	{
		$client = static::createClient();

		$client->request('GET', '/events');

		$json = '[{"id":1,"slug":"frodon-quitte-hobbitebourg","name":"Frodon quitte Hobbitebourg","date":"3018-09-23T00:00:00+0100","date_end":"3018-09-23T00:00:00+0100","coordx":13,"coordy":24},{"id":2,"slug":"nazgul-atteint-hobbitebourg","name":"Un Nazg\u00fbl atteint Hobbitebourg \u00e0 la nuit tomb\u00e9e","date":"3018-09-23T00:00:00+0100","date_end":"3018-09-23T00:00:00+0100","coordx":13,"coordy":24},{"id":3,"slug":"attaque-nazgul-poney-fringant","name":"\u00c0 l\'aube, attaque des Nazg\u00fbl sur le Creux-de-Crique et l\'Auberge du Poney Fringant","date":"3018-09-30T00:00:00+0100","date_end":"3018-09-30T00:00:00+0100","coordx":26,"coordy":26},{"id":4,"slug":"frodon-blesse-lame-morgul","name":"Frodon est bless\u00e9 par la lame de Morgul","date":"3018-10-06T00:00:00+0100","date_end":"3018-10-06T00:00:00+0100","coordx":32,"coordy":26},{"id":5,"slug":"frodon-guerit-lame-morgul","name":"Frodon revient \u00e0 lui","date":"3018-10-24T00:00:00+0100","date_end":"3018-10-24T00:00:00+0100","coordx":41,"coordy":26},{"id":6,"slug":"conseil-elrond","name":"Le Conseil d\'Elrond","date":"3018-10-25T00:00:00+0100","date_end":"3018-10-25T00:00:00+0100","coordx":41,"coordy":26},{"id":7,"slug":"depart-communaute-fondcombe","name":"La Communaut\u00e9 part de Fondcombe","date":"3018-12-25T00:00:00+0100","date_end":"3018-12-25T00:00:00+0100","coordx":41,"coordy":26},{"id":8,"slug":"communaute-entre-dans-moria","name":"La Communaut\u00e9 atteint la Porte Ouest au cr\u00e9puscule et entre dans la Moria","date":"3019-01-13T00:00:00+0100","date_end":"3019-01-13T00:00:00+0100","coordx":41,"coordy":35},{"id":9,"slug":"chute-gandalf-balrog","name":"Duel du Balrog et de Gandalf, qui chutent dans l\'ab\u00eeme du Pont de Khazad-d\u00fbm","date":"3019-01-15T00:00:00+0100","date_end":"3019-01-15T00:00:00+0100","coordx":41,"coordy":35},{"id":10,"slug":"gandalf-tue-balrog","name":"Gandalf vainc le Balrog, et s\'\u00e9vanuit. Son corps g\u00eet au sommet du Zirakzigil","date":"3019-01-25T00:00:00+0100","date_end":"3019-01-25T00:00:00+0100","coordx":41,"coordy":35},{"id":11,"slug":"gandalf-renait","name":"Gandalf revient \u00e0 la vie","date":"3019-02-15T00:00:00+0100","date_end":"3019-02-15T00:00:00+0100","coordx":41,"coordy":35},{"id":12,"slug":"bataille-1-gues-isen","name":"Premi\u00e8re bataille des gu\u00e9s de l\'Isen","date":"3019-02-25T00:00:00+0100","date_end":"3019-02-25T00:00:00+0100","coordx":48,"coordy":38},{"id":13,"slug":"mort-de-theodred","name":"Mort de Th\u00e9odred fils de Th\u00e9oden ","date":"3019-02-25T00:00:00+0100","date_end":"3019-02-25T00:00:00+0100","coordx":48,"coordy":38},{"id":14,"slug":"mort-de-boromir","name":"Mort de Boromir","date":"3019-02-26T00:00:00+0100","date_end":"3019-02-26T00:00:00+0100","coordx":54,"coordy":49},{"id":15,"slug":"merry-pippin-prisonniers-uruk-hai","name":"Merry & Pippin sont faits prisonniers par les Uruks d\'Ugl\u00fak.","date":"3019-02-26T00:00:00+0100","date_end":"3019-02-26T00:00:00+0100","coordx":54,"coordy":49},{"id":16,"slug":"eomer-massacre-uruk-hai","name":"\u00c9omer rattrape les Orques \u00e0 la lisi\u00e8re de Fangorn.","date":"3019-02-28T00:00:00+0100","date_end":"3019-02-28T00:00:00+0100","coordx":45,"coordy":47},{"id":17,"slug":"merry-pippin-rencontrent-sylvebarbe","name":"Merry et Pippin s\'\u00e9chappent et rencontrent Sylvebarbe.","date":"3019-02-28T00:00:00+0100","date_end":"3019-02-28T00:00:00+0100","coordx":43,"coordy":44},{"id":18,"slug":"frodon-rencontre-gollum","name":"Frodon descend de l\'Emyn Muil et rencontre Gollum.","date":"3019-02-28T00:00:00+0100","date_end":"3019-02-28T00:00:00+0100","coordx":59,"coordy":47},{"id":19,"slug":"chambre-des-ents","name":"Chambre des Ents.","date":"3019-02-28T00:00:00+0100","date_end":"3019-03-01T00:00:00+0100","coordx":43,"coordy":44},{"id":20,"slug":"traversee-marais-des-morts","name":"Frodon Sam et Golum traverse le Marais des Morts.","date":"3019-03-01T00:00:00+0100","date_end":"3019-03-02T00:00:00+0100","coordx":64,"coordy":49},{"id":21,"slug":"gandalf-blanc-retrouve-aragorn","name":"Aragorn, Legolas et Gimli rencontrent Gandalf le Blanc, et ils partent pour Edoras.","date":"3019-03-01T00:00:00+0100","date_end":"3019-03-01T00:00:00+0100","coordx":43,"coordy":45},{"id":22,"slug":"ents-detruisent-isengard","name":"Les Ents d\u00e9truisent Isengard","date":"3019-03-02T00:00:00+0100","date_end":"3019-03-03T00:00:00+0100","coordx":37,"coordy":46},{"id":23,"slug":"gandalf-guerit-theoden","name":"Gandalf arrive \u00e0 Edoras et gu\u00e9rit Th\u00e9oden.","date":"3019-03-02T00:00:00+0100","date_end":"3019-03-02T00:00:00+0100","coordx":42,"coordy":53},{"id":24,"slug":"bataille-2-gue-isen","name":"Deuxi\u00e8me Bataille des Gu\u00e9s de l\'Isen. Erkenbrand est battu.","date":"3019-03-02T00:00:00+0100","date_end":"3019-03-02T00:00:00+0100","coordx":48,"coordy":38},{"id":25,"slug":"bataille-gouffre-helm","name":"Bataille du Gouffre de Helm \/ Bataille de Fort-le-Cor","date":"3019-03-03T00:00:00+0100","date_end":"3019-03-04T00:00:00+0100","coordx":38,"coordy":52},{"id":26,"slug":"mort-saroumane","name":"Mort de Saroumane","date":"3019-03-06T00:00:00+0100","date_end":"3019-03-06T00:00:00+0100","coordx":37,"coordy":46},{"id":27,"slug":"frodon-prisonnier-par-faramir","name":"Frodon est fait prisonnier et emmen\u00e9 \u00e0 Henneth Ann\u00fbn par Faramir.","date":"3019-03-07T00:00:00+0100","date_end":"3019-03-07T00:00:00+0100","coordx":57,"coordy":58},{"id":28,"slug":"aragorn-recupere-armee-des-morts","name":"Aragorn, Legolas et Gimli r\u00e9cup\u00e8re l\'arm\u00e9e des morts","date":"3019-03-08T00:00:00+0100","date_end":"3019-03-08T00:00:00+0100","coordx":40,"coordy":57},{"id":29,"slug":"aragorn-atteint-calembel","name":"Aragorn, avec l\'Arm\u00e9e des Morts, partis d\'Erech, atteignent Calembel.","date":"3019-03-09T00:00:00+0100","date_end":"3019-03-09T00:00:00+0100","coordx":43,"coordy":62},{"id":30,"slug":"diffusion-tenebres-hors-mordor","name":"Des t\u00e9n\u00e8bres commencent \u00e0 se r\u00e9pandre hors du Mordor.","date":"3019-03-09T00:00:00+0100","date_end":"3019-03-09T00:00:00+0100","coordx":64,"coordy":65},{"id":31,"slug":"grand-rassemblement-du-rohan","name":"Le Grand Rassemblement du Rohan : les Rohirrim partent de Dunharrow","date":"3019-03-10T00:00:00+0100","date_end":"3019-03-10T00:00:00+0100","coordx":42,"coordy":56},{"id":32,"slug":"invasion-ouest-rohan-par-nord","name":"L\'ouest du Rohan est envahi par le nord.","date":"3019-03-11T00:00:00+0100","date_end":"3019-03-11T00:00:00+0100","coordx":47,"coordy":40},{"id":33,"slug":"attaque-1-dol-guldur-lorien","name":"Premi\u00e8re attaque de Dol Guldur sur la L\u00f3rien.","date":"3019-03-11T00:00:00+0100","date_end":"3019-03-11T00:00:00+0100","coordx":58,"coordy":37},{"id":34,"slug":"aragorn-chasse-ennemi-vers-pelargir","name":"Aragorn chasse l\'ennemi vers Pelargir.","date":"3019-03-12T00:00:00+0100","date_end":"3019-03-12T00:00:00+0100","coordx":54,"coordy":68},{"id":35,"slug":"frodon-antre-arachne","name":"Gollum conduit Frodo dans l\'antre d\'Arachne.","date":"3019-03-12T00:00:00+0100","date_end":"3019-03-12T00:00:00+0100","coordx":66,"coordy":61},{"id":36,"slug":"invasion-champs-pelennor","name":"Les Champs du Pelennor sont envahis.","date":"3019-03-13T00:00:00+0100","date_end":"3019-03-13T00:00:00+0100","coordx":59,"coordy":60},{"id":37,"slug":"aragorn-atteint-pelagir","name":"Aragorn atteint Pelargir et capture la flotte pirate.","date":"3019-03-13T00:00:00+0100","date_end":"3019-03-13T00:00:00+0100","coordx":54,"coordy":69},{"id":38,"slug":"siege-minas-tirith","name":"Minas Tirith est assi\u00e9g\u00e9e.","date":"3019-03-14T00:00:00+0100","date_end":"3019-03-15T00:00:00+0100","coordx":59,"coordy":60},{"id":39,"slug":"chute-porte-minas-tirith","name":"Au petit jour, le Roi-Sorcier enfonce les portes de Minas Tirith.","date":"3019-03-15T00:00:00+0100","date_end":"3019-03-15T00:00:00+0100","coordx":59,"coordy":60},{"id":40,"slug":"suicide-denethor","name":"Denethor se donne la mort sur un b\u00fbcher fun\u00e9raire.","date":"3019-03-15T00:00:00+0100","date_end":"3019-03-15T00:00:00+0100","coordx":59,"coordy":60},{"id":41,"slug":"bataille-champ-pelennor","name":"Bataille des Champs de Pelennor.","date":"3019-03-15T00:00:00+0100","date_end":"3019-03-15T00:00:00+0100","coordx":59,"coordy":60},{"id":42,"slug":"mort-de-theoden","name":"Mort de Th\u00e9oden.","date":"3019-03-15T00:00:00+0100","date_end":"3019-03-15T00:00:00+0100","coordx":59,"coordy":60},{"id":43,"slug":"mort-roi-sorcier","name":"Mort du Roi-Sorcier, tu\u00e9 par \u00c9owyn et Merry.","date":"3019-03-15T00:00:00+0100","date_end":"3019-03-15T00:00:00+0100","coordx":59,"coordy":60},{"id":44,"slug":"attaque-2-dol-guldur-lorien","name":"Second attaque de Dol Guldur sur la L\u00f3rien.","date":"3019-03-15T00:00:00+0100","date_end":"3019-03-15T00:00:00+0100","coordx":58,"coordy":37},{"id":45,"slug":"bataille-de-dale","name":"Bataille de Dale","date":"3019-03-17T00:00:00+0100","date_end":"3019-03-17T00:00:00+0100","coordx":69,"coordy":25},{"id":46,"slug":"armee-ouest-part-minas-tirith","name":"L\'Arm\u00e9e de l\'Ouest part de Minas Tirith.","date":"3019-03-18T00:00:00+0100","date_end":"3019-03-18T00:00:00+0100","coordx":59,"coordy":60},{"id":47,"slug":"attaque-3-dol-guldur-lorien","name":"Troisi\u00e8me attaque de Dol Guldur sur la L\u00f3rien.","date":"3019-03-22T00:00:00+0100","date_end":"3019-03-22T00:00:00+0100","coordx":58,"coordy":37},{"id":48,"slug":"armee-ouest-encerclee-porte-noire","name":"L\'Arm\u00e9e de l\'Ouest est encercl\u00e9e devant la Porte Noire.","date":"3019-03-25T00:00:00+0100","date_end":"3019-03-25T00:00:00+0100","coordx":69,"coordy":52},{"id":49,"slug":"arrivee-montage-du-destin","name":"Frodo et Sam atteignent la Montage du Destin, o\u00f9 l\'Anneau a \u00e9t\u00e9 forg\u00e9.","date":"3019-03-25T00:00:00+0100","date_end":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58},{"id":50,"slug":"mort-de-gollum","name":"Mort de Gollum.","date":"3019-03-25T00:00:00+0100","date_end":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58},{"id":51,"slug":"destruction-anneau-unique","name":"Destruction de l\'Anneau Unique.","date":"3019-03-25T00:00:00+0100","date_end":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58},{"id":52,"slug":"chute-barad-dur-fin-sauron","name":"Chute de Barad-D\u00fbr, et fin de Sauron.","date":"3019-03-25T00:00:00+0100","date_end":"3019-03-25T00:00:00+0100","coordx":80,"coordy":57}]';

		$this->assertEquals($json, $client->getResponse()->getContent());
		$this->assertJson($client->getResponse()->getContent());
	}

	public function testgetEvent()
	{
		$client = static::createClient();

		$client->request('GET', '/event/mort-de-gollum');

		$json = '[{"id":50,"slug":"mort-de-gollum","name":"Mort de Gollum.","date":"3019-03-25T00:00:00+0100","date_end":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58}]';

		$this->assertEquals($json, $client->getResponse()->getContent());
		$this->assertJson($client->getResponse()->getContent());
	}

	public function testgetEventPositionCharacters()
	{
		$client = static::createClient();

		$client->request('GET', '/event/mort-de-gollum/position/characters');

		$json = '[[{"id":50,"slug":"mort-de-gollum","name":"Mort de Gollum.","date":"3019-03-25T00:00:00+0100","date_end":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58}],[{"id":184,"character":{"id":1,"slug":"aragorn","name":"Aragorn, dit Grands-Pas","race":{"id":1,"slug":"homme","description":"L\'humanit\u00e9, race jeune en opposition aux autres races humano\u00efdes telles les Elfes, les Nains ou les Orques."}},"date":"3019-03-25T00:00:00+0100","coordx":69,"coordy":52,"status":{"id":1,"slug":"Bonne sant\u00e9"}},{"id":368,"character":{"id":2,"slug":"boromir","name":"Boromir, fils de Denethor","race":{"id":1,"slug":"homme","description":"L\'humanit\u00e9, race jeune en opposition aux autres races humano\u00efdes telles les Elfes, les Nains ou les Orques."}},"date":"3019-03-25T00:00:00+0100","coordx":61,"coordy":56,"status":{"id":3,"slug":"Mort"}},{"id":552,"character":{"id":3,"slug":"frodon","name":"Frodon Sacquet","race":{"id":3,"slug":"hobbit","description":"Egalement appel\u00e9s Semi-hommes ou Periannath."}},"date":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58,"status":{"id":5,"slug":"Croqu\u00e9 le doigt !"}},{"id":736,"character":{"id":4,"slug":"gandalf","name":"Gandalf le gris, puis Gandalf le blanc","race":{"id":4,"slug":"maia","description":"Ils font partie des Ainur, les divinit\u00e9s issues de l\'esprit d\'Il\u00favatar, le dieu cr\u00e9ateur."}},"date":"3019-03-25T00:00:00+0100","coordx":69,"coordy":52,"status":{"id":1,"slug":"Bonne sant\u00e9"}},{"id":920,"character":{"id":5,"slug":"gimli","name":"Gimli, fils de Gl\u00f3in","race":{"id":2,"slug":"elfe","description":"Les a\u00een\u00e9s des Enfants d\'Il\u00favatar, les cadets \u00e9tant les Hommes."}},"date":"3019-03-25T00:00:00+0100","coordx":69,"coordy":52,"status":{"id":1,"slug":"Bonne sant\u00e9"}},{"id":1104,"character":{"id":6,"slug":"legolas","name":"Legolas Vertefeuille, fils de Thranduil","race":{"id":2,"slug":"elfe","description":"Les a\u00een\u00e9s des Enfants d\'Il\u00favatar, les cadets \u00e9tant les Hommes."}},"date":"3019-03-25T00:00:00+0100","coordx":69,"coordy":52,"status":{"id":1,"slug":"Bonne sant\u00e9"}},{"id":1288,"character":{"id":7,"slug":"merry","name":"Meriadoc Brandebouc, dit Merry","race":{"id":3,"slug":"hobbit","description":"Egalement appel\u00e9s Semi-hommes ou Periannath."}},"date":"3019-03-25T00:00:00+0100","coordx":69,"coordy":52,"status":{"id":1,"slug":"Bonne sant\u00e9"}},{"id":1472,"character":{"id":8,"slug":"pippin","name":"Peregrin Touque, dit Pippin","race":{"id":3,"slug":"hobbit","description":"Egalement appel\u00e9s Semi-hommes ou Periannath."}},"date":"3019-03-25T00:00:00+0100","coordx":69,"coordy":52,"status":{"id":1,"slug":"Bonne sant\u00e9"}},{"id":1656,"character":{"id":9,"slug":"sam","name":"Samsagace Gamegie, dit Sam","race":{"id":3,"slug":"hobbit","description":"Egalement appel\u00e9s Semi-hommes ou Periannath."}},"date":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58,"status":{"id":1,"slug":"Bonne sant\u00e9"}}]]';

		$this->assertEquals($json, $client->getResponse()->getContent());
		$this->assertJson($client->getResponse()->getContent());
	}

	public function testgetEventPresentCharacters()
	{
		$client = static::createClient();

		$client->request('GET', '/event/mort-de-gollum/present/characters');

		$json = '[[{"id":50,"slug":"mort-de-gollum","name":"Mort de Gollum.","date":"3019-03-25T00:00:00+0100","date_end":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58}],[{"id":552,"character":{"id":3,"slug":"frodon","name":"Frodon Sacquet","race":{"id":3,"slug":"hobbit","description":"Egalement appel\u00e9s Semi-hommes ou Periannath."}},"date":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58,"status":{"id":5,"slug":"Croqu\u00e9 le doigt !"}},{"id":1656,"character":{"id":9,"slug":"sam","name":"Samsagace Gamegie, dit Sam","race":{"id":3,"slug":"hobbit","description":"Egalement appel\u00e9s Semi-hommes ou Periannath."}},"date":"3019-03-25T00:00:00+0100","coordx":75,"coordy":58,"status":{"id":1,"slug":"Bonne sant\u00e9"}}]]';

		$this->assertEquals($json, $client->getResponse()->getContent());
		$this->assertJson($client->getResponse()->getContent());
	}
}
